<div class="item__i mobileHide">
    <div class="top">
        <div class="top__i">

            <table>
                <tbody><tr>
                    <td>
                        <div class="text">
                            <div class="iconBox" ng-click="vm.switchService()">
                                <i class="icon_luggage"></i>
                            </div>
                            <div class="name">
                                <h2>
                                    {{ 'web.extraServices.baggage.header' | aliasStatic}}
                                    <a href fancybox="popupAlias" data-popup-alias="web.extraServicesRules.baggage">
                                        <span class="infoBoxWrap">
                                            <i class="icon_info"></i>
                                            <span class="infoBox">
                                                <span class="infoBox__i">
                                                    {{ 'web.extraServices.serviceDesc' | aliasStatic}}
                                                </span>
                                            </span>
                                        </span>
                                    </a>
                                </h2>
                                <p>
                                    {{ 'web.extraServices.baggage.desc' | aliasStatic}}
                                </p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div ng-if="vm.service.active && vm.service.editablePrice" class="price">
                            <div class="price__i">
                                <h3 ng-bind-html="{ value: vm.service.editablePrice.price, currency: vm.service.editablePrice.currency } | price"></h3>
                            </div>
                        </div>
                        <div ng-if="!vm.service.active" class="price">
                            <div class="price__i">
                                <p>
                                    {{ 'web.extraServices.minPrice' | aliasStatic}}
                                </p>
                                <h3 ng-bind-html="{ value: vm.service.minPrice.price, currency: vm.service.minPrice.currency } | price"></h3>
                                <p>
                                    {{ 'web.extraServices.baggage.minPriceUnit' | aliasStatic}}
                                </p>
                            </div>
                        </div>
                    </td>
                    <td>
                        <a href ng-click="vm.switchService()" ng-if="!vm.checkServiceRemovalProhibited('baggage')"
                             ng-class="{ active: vm.service.active, control_disabled: vm.locked }" class="btn showDrop_js ">
                            <span class="show">
                                {{ 'web.extraServices.baggage.select' | aliasStatic}}
                            </span>
                            <span class="hide">
                                {{ 'web.extraServices.baggage.deselect' | aliasStatic}}
                            </span>
                        </a>
                    </td>
                </tr>
            </tbody></table>

        </div>
    </div>


    <div class="drop" ng-class="{ active: vm.service.active, show_js: vm.service.active }">
        <div class="drop__i">

            <div class="selectBaggage mobileHide">
                <div class="selectBaggage__i">

                    <table class="passengersTable">
                        <tbody>
                            <tr class="headRow">
                                <td class="firstCol"></td>
                                <td ng-repeat="(passengerNum, passenger) in vm.orderInfo.passengers">
                                    {{ passenger.lastName }} {{ passenger.firstName }}
                                </td>
                            </tr>
                            <tr ng-repeat-start="(routePartNum, routePart) in vm.service.routeParts"
                                class="contentRow">
                                <td class="firstCol">
                                    <div class="date">
                                        {{ routePart.flightsInfo.date | formatDate: 'D MMMM, dd'}}
                                    </div>
                                    <div class="route">
                                        <geo-marker prefix="dep__point" key="es-baggage" city="routePart.flightsInfo.origincity"  cityname="routePart.flightsInfo.origincityName" port="routePart.flightsInfo.originport"  portname="routePart.flightsInfo.originportName"></geo-marker>
                                        <div class="route__plane">
                                            <i class="icon_plane"></i>
                                        </div>
                                        <geo-marker prefix="arr__point" key="es-baggage" city="routePart.flightsInfo.destinationcity"  cityname="routePart.flightsInfo.destinationcityName" port="routePart.flightsInfo.destinationport"  portname="routePart.flightsInfo.destinationportName"></geo-marker>
                                    </div>
                                </td>
                                <td ng-repeat="(passengerNum, availableExtraServicesBySubgroups) in routePart.availableExtraServicesByPassengersAndSubgroups"
                                    ng-class="{ active: vm.selectedRoutePartNum == routePartNum && vm.selectedPassenger == passengerNum }"
                                     ng-init="selectedPassengerRoutePartBaggage = vm.getSelectedPassengerRoutePartBaggage(passengerNum, routePartNum)">
                                    <a href ng-click="vm.selectRoutePartPassenger(routePartNum, passengerNum)"
                                        class="passengersTable__link"
                                        ng-class="{ passengersTable__link_empty: !selectedPassengerRoutePartBaggage, passengersTable__link_select: (!selectedPassengerRoutePartBaggage && vm.selectedRoutePartNum == routePartNum && vm.selectedPassenger == passengerNum) }">
                                        <wrap ng-if="!selectedPassengerRoutePartBaggage && (vm.selectedRoutePartNum == routePartNum && vm.selectedPassenger == passengerNum)">
                                            {{ 'web.extraServices.baggage.selectItem' | aliasStatic}}
                                        </wrap>
                                        <wrap ng-if="!selectedPassengerRoutePartBaggage && !(vm.selectedRoutePartNum == routePartNum && vm.selectedPassenger == passengerNum)">
                                            {{ 'web.extraServices.baggage.noneSelected' | aliasStatic}}
                                        </wrap>
                                        <wrap ng-if="selectedPassengerRoutePartBaggage">
                                            {{ selectedPassengerRoutePartBaggage.count }}
                                            {{ 'web.search.priceDetail.label.luggDescMsr.' | aliasWithPrefix:'pc' }}
                                            <span ng-bind-html=" { value: selectedPassengerRoutePartBaggage.cost, currency: selectedPassengerRoutePartBaggage.currency } | price"></span>
                                        </wrap>
                                    </a>
                                    <a ng-if="selectedPassengerRoutePartBaggage && !vm.checkServiceRemovalProhibited('baggage', passengerNum, routePart.mainFlightNum)" 
                                        href ng-click="vm.removePassengerFlightBaggage(passengerNum, routePart.mainFlightNum)" class="btn-remove">
                                        <span class="infoBoxWrap">
                                            <i class="icon_remove"></i>
                                            <span class="infoBox">
                                                <span class="infoBox__i">
                                                    {{ 'web.extraServices.baggage.cancelByPassengerSegment' | aliasStatic }}
                                                </span>
                                            </span>
                                        </span>
                                    </a>
                                </td>
                            </tr>

                            <tr ng-repeat-end class="contentServiceRow">
                                <td ng-if="routePartNum == vm.selectedRoutePartNum" class="firstCol"></td>
                                <td ng-if="routePartNum == vm.selectedRoutePartNum" colspan="{{ vm.orderInfo.passengers.length }}">


                                    <div class="baggage_container">
                                        
                                        <table class="baggage_table baggage_table--free">
                                            <tbody>
                                                <tr ng-repeat="freeBaggageItem in vm.service.routeParts[vm.selectedRoutePartNum].flightsInfo.freeBaggage" ng-if="freeBaggageItem.passengerCode == vm.orderInfo.passengers[vm.selectedPassenger].categoryCode">
                                                    <td>
                                                        <span class="baggage_info baggage_info_caption free">
                                                            {{ 'web.extraServices.baggage.freeLugg' | aliasStatic}}
                                                            {{ freeBaggageItem.companyCode }}-{{ freeBaggageItem.racenumber }}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <span class="baggage_info">
                                                            {{ freeBaggageItem.luggNorm }} {{ 'web.search.priceDetail.label.luggDescMsr.' | aliasWithPrefix:freeBaggageItem.luggNormMsr }}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <span class="baggage_info free">
                                                            {{ 'web.extraServices.baggage.freeLuggPrice' | aliasStatic}}
                                                        </span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        
                                        <wrap ng-repeat="(subgroupNum, subgroup) in vm.service.subgroups">
                                            <wrap ng-if="subgroup.type == 'COUNTABLE_MULTIPLE_SELECT'">
                                                <table class="baggage_table">
                                                    <tr ng-repeat="(itemNum, baggageItem) in vm.service.routeParts[vm.selectedRoutePartNum].availableExtraServicesByPassengersAndSubgroups[vm.selectedPassenger][subgroupNum]" class="baggage-picker-cont">

                                                        <td>
                                                            <span class="baggage_info baggage_info_caption">
                                                                {{ baggageItem.title }}, <span ng-bind-html=" { value: baggageItem.price, currency: baggageItem.currency} | price"></span>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <service-picker count="baggageItem.alreadySelectedCount"
                                                                limit="baggageItem.limit"
                                                                locked="vm.locked"
                                                                on-increase="vm.baggageCountChangeHandler(subgroupNum, baggageItem, +1, vm.selectedPassenger, vm.selectedRoutePartNum)"
                                                                on-decrease="vm.baggageCountChangeHandler(subgroupNum, baggageItem, -1, vm.selectedPassenger, vm.selectedRoutePartNum)">
                                                            </service-picker>
                                                        </td>
                                                        <td>
                                                            <span class="baggage_info" ng-if="baggageItem.totalPrice" ng-bind-html="{ value: baggageItem.totalPrice, currency: baggageItem.currency} | price"></span>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </wrap>
                                            
                                            <wrap ng-if="subgroup.type == 'SELECT'"
                                                ng-repeat="(subgroupNum, baggageSubgoupOptions) in vm.optionsByRoutePartsAndPassengers[vm.selectedRoutePartNum][vm.selectedPassenger]">
                                                <ui-select name="selectedBaggage"
                                                    ng-model="vm.selectedBaggageByRoutePartsAndPassengersView[vm.selectedRoutePartNum][vm.selectedPassenger][subgroupNum]"
                                                    ng-change="vm.changeBaggageBySelect(vm.selectedPassenger, vm.selectedRoutePartNum, subgroupNum);"
                                                    theme="selectize"
                                                    search-enabled="false"
                                                    ng-disabled="vm.locked"
                                                    required>
                                                   <ui-select-match placeholder="{{$select.selected.title || ( 'web.extraServices.baggage.noneSelected' | aliasStatic) }}">
                                                       {{$select.selected.title}}
                                                   </ui-select-match>
                                                   <ui-select-choices repeat="baggageOption.index as baggageOption in baggageSubgoupOptions">
                                                       <div>{{ baggageOption.title }}</div>
                                                   </ui-select-choices>
                                               </ui-select>

                                            </wrap>
                                            
                                        </wrap>
                                        
                                    </div>


                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="passengersTable__cancel">
                        <a href ng-click="vm.switchService()"
                            ng-if="!vm.checkServiceRemovalProhibited('baggage')"
                            class="passengersTable__link passengersTable__link_cancel">
                            {{ 'web.extraServices.baggage.cancel' | aliasStatic}}
                        </a>
                    </div>

                </div>
            </div>

        </div>
    </div>

</div>



<div class="item__i mobileShow">

	<div class="top">
        <div class="top__i">
            <a href>
				<div class="row">
					<table>
						<tbody>
                            <tr>
                                <td>
                                    <i class="icon_luggage"></i>
                                </td>
                                <td>
								    <div class="name">
                                        {{ 'web.extraServices.baggage.header' | aliasStatic}}
                                        <a href fancybox="popupAlias" data-popup-alias="web.extraServicesRules.baggage">
                                            <i class="icon_info"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
				</div>
			</a>
            <div class="row">
                <a href>
                    <div ng-if="vm.service.active && vm.service.editablePrice" class="price">
                        <div class="price__i">
                            <h3 ng-bind-html="{ value: vm.service.editablePrice.price, currency: vm.service.editablePrice.currency } | price"></h3>
                        </div>
                    </div>
                    <div ng-if="!vm.service.active && vm.service.minPrice" class="price">
                        <div class="price__i">
                            <p>
                                {{ 'web.extraServices.minPrice' | aliasStatic}}
                            </p>
                            <h3 ng-bind-html="{ value: vm.service.minPrice.price, currency: vm.service.minPrice.currency } | price"></h3>
                            <p>
                                {{ 'web.extraServices.baggage.minPriceUnit' | aliasStatic}}
                            </p>
                        </div>
                    </div>
                </a>
                <a href ng-click="vm.switchService()" 
                    ng-if="!vm.checkServiceRemovalProhibited('baggage')"
                    ng-class="{ active: vm.service.active }" class="btn showDrop_js">
                    <span class="show">
                        {{ 'web.extraServices.baggage.select' | aliasStatic}}
                    </span>
                    <span class="hide">
                        {{ 'web.extraServices.baggage.deselect' | aliasStatic}}
                    </span>
                </a>
			</div>
		</div>
	</div>


    <div class="drop" ng-class="{ active: vm.service.active, show_js: vm.service.active }">
        <div class="drop__i">
            <div class="baggage_container drop_mobile">
                <div class="passengersContainer">
                    <div class="passengersTableContainer" ng-class="{ one_passenger: vm.orderInfo.passengers.length == 1 }">

                        <a href ng-click="vm.scrollToEnd();" class="passengersTableContainer__control passengersTableContainer__control_next"  ng-class="{ control_disabled: !vm.canScrollRight }"></a>
                        <table class="passengersTable">
                            <tbody>
                                <tr class="headRow">
                                    <td class="firstCol">
                                        <a href ng-click="vm.scrollToStart();" class="passengersTable__control passengersTable__control_prev" ng-class="{ control_disabled: !vm.canScrollLeft }"></a>
                                    </td>
                                    <td ng-repeat="(passengerNum, passenger) in vm.orderInfo.passengers">
                                        {{ passenger.lastName }} {{ passenger.firstName }}
                                    </td>
                                </tr>
                                <tr ng-repeat="(routePartNum, routePart) in vm.service.routeParts" class="contentRow">
                                    <td class="firstCol">
                                        <div class="date">
                                            {{ routePart.flightsInfo.date | formatDate: 'D MMMM, dd'}}
                                        </div>
                                        <div class="route">
                                            <geo-marker prefix="dep__point" key="es-baggage" city="routePart.flightsInfo.origincity"  cityname="routePart.flightsInfo.origincityName" port="routePart.flightsInfo.originport"  portname="routePart.flightsInfo.originportName"></geo-marker>
                                            <div class="route__plane">
                                                <i class="icon_plane"></i>
                                            </div>
                                            <geo-marker prefix="arr__point" key="es-baggage" city="routePart.flightsInfo.destinationcity"  cityname="routePart.flightsInfo.destinationcityName" port="routePart.flightsInfo.destinationport"  portname="routePart.flightsInfo.destinationportName"></geo-marker>
                                        </div>
                                    </td>
                                    <td ng-repeat="(passengerNum, availableExtraServicesBySubgroups) in routePart.availableExtraServicesByPassengersAndSubgroups"
                                        ng-class="{ active: vm.selectedRoutePartNum == routePartNum && vm.selectedPassenger == passengerNum }"
                                        ng-init="selectedPassengerRoutePartBaggage = vm.getSelectedPassengerRoutePartBaggage(passengerNum, routePartNum)">

                                        <a href fancybox="selectBaggage" ng-click="vm.selectRoutePartPassenger(routePartNum, passengerNum)"
                                        class="passengersTable__link"
                                        ng-class="{ passengersTable__link_empty: !selectedPassengerRoutePartBaggage, passengersTable__link_select: (!selectedPassengerRoutePartBaggage && vm.selectedRoutePartNum == routePartNum && vm.selectedPassenger == passengerNum) }">
                                            <wrap ng-if="!selectedPassengerRoutePartBaggage && (vm.selectedRoutePartNum == routePartNum && vm.selectedPassenger == passengerNum)">
                                                {{ 'web.extraServices.baggage.selectItem' | aliasStatic}}
                                            </wrap>
                                            <wrap ng-if="!selectedPassengerRoutePartBaggage && !(vm.selectedRoutePartNum == routePartNum && vm.selectedPassenger == passengerNum)">
                                                {{ 'web.extraServices.baggage.noneSelected' | aliasStatic}}
                                            </wrap>
                                            <wrap ng-if="selectedPassengerRoutePartBaggage">
                                                {{ selectedPassengerRoutePartBaggage.count }}
                                                {{ 'web.search.priceDetail.label.luggDescMsr.' | aliasWithPrefix:'pc' }}
                                                <span ng-bind-html=" { value: selectedPassengerRoutePartBaggage.cost, currency: selectedPassengerRoutePartBaggage.currency } | price"></span>
                                            </wrap>
                                        </a>
                                        <a ng-if="selectedPassengerRoutePartBaggage && !vm.checkServiceRemovalProhibited('baggage', passengerNum, routePart.mainFlightNum)" 
                                            href ng-click="vm.removePassengerFlightBaggage(passengerNum, routePart.mainFlightNum)" class="btn-remove">
                                            <span class="infoBoxWrap">
                                                <i class="icon_remove"></i>
                                                <span class="infoBox">
                                                    <span class="infoBox__i">
                                                        {{ 'web.extraServices.baggage.cancelByPassengerSegment' | aliasStatic }}
                                                    </span>
                                                </span>
                                            </span>
                                        </a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                </div>
                <div class="passengersTable__cancel">
                    <a href ng-click="vm.switchService()" 
                        ng-if="!vm.checkServiceRemovalProhibited('baggage')"
                        class="passengersTable__link passengersTable__link_cancel">
                        {{ 'web.extraServices.baggage.cancel' | aliasStatic}}
                    </a>
                </div>
            </div>
        </div>
    </div>

    <popup-baggage
        passenger="vm.selectedPassenger"
        route-part="vm.selectedRoutePartNum"
        order="vm.orderInfo"
        service="vm.service"
        locked="vm.locked"
        change="vm.baggageCountChangeHandler"
        remove="vm.removeByPassenger"
        options="vm.optionsByRoutePartsAndPassengers"
        selected="vm.selectedBaggageByRoutePartsAndPassengers"
        selected-view="vm.selectedBaggageByRoutePartsAndPassengersView"
        change-baggage-by-select="vm.changeBaggageBySelect">
    </popup-baggage>

</div>


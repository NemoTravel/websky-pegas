{"version":3,"sources":["controllers-pegas.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","MealControllerPegas","$scope","$element","backend","utils","switchService","vm","locked","checkServiceRemovalProhibited","service","active","selectFirstAvailablePassengerFlight","removeExtraService","resetService","selectFlightPassenger","flightNum","passengerNum","selectedFlight","selectedPassenger","updateMealMenu","getFirstAvailableFlightNum","getFirstAvailablePassengerNum","mealMenu","itemsByPassengerSegments","mealMenuSubgroup","mealCountChangeHandler","subgroupNum","mealItem","delta","modifyExtraService","passenger_id","orderInfo","passengers","id","segment_id","plainFlights","subgroup","subgroups","amount","alreadySelectedCount","service_type","serviceType","rfisc","removePassengerFlightMeal","getSelectedPassengerFlightMeal","currency","count","cost","groupedEditableExtraServices","meal","forEach","item","totalPrice","Big","plus","toFixed","scrollToStart","passengersTableContainer","scrollTo","scrollToEnd","scrollWidth","mobileTableScrollHandler","scrollLeft","clientWidth","scrollRight","canScrollRight","canScrollLeft","$apply","availableBySegments","availableByPassengerSegments","this","find","hasAlias","getAvailablePassengersCount","getParam","mealImagesPath","addOrderInfoListener","$watch","on","angular","component","templateUrl","controller","controllerAs","bindings","2","SeatControllerPegas","$timeout","modifyError","then","clearFlightPassenger","resp","error","seatMap","setSeatMapContainerTopPosition","reset","seatMapContainerTopPosition","jQuery","css","updateSeatMap","loadingSeatMap","seatMapError","setPassengerFlightSeat","chair","cabinAllowed","rowNumber","available","value","number","commonSubgroup","updateSunInfoByFlights","sunInfoByFlights","flight","sunInfo","origincity","departuredate","departuretime","destinationcity","arrivaldate","arrivaltime","getAvailablePassengersCountWrap","filter","pax","hasSeats","removePassengerFlightSeat","3","./components/es-meal-pegas/es-meal-pegas","./components/es-seat-pegas/es-seat-pegas"],"mappings":"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","file":"controllers-pegas.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esMealPegas', {\n    templateUrl: 'components/es-meal-pegas/es-meal-pegas.html',\n    controller: ['$scope', '$element','backend', 'utils', MealControllerPegas],\n    controllerAs: 'vm',\n    bindings: {\n        service: '=service',\n        locked: '=locked'\n    }\n});\n\nfunction MealControllerPegas($scope, $element, backend, utils) {\n\n    var vm = this,\n        passengersTableContainer = $element.find('div.passengersTableContainer');\n\n    vm.switchService = switchService;\n    vm.resetService = resetService;\n    vm.selectFlightPassenger = selectFlightPassenger;\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\n    vm.mealCountChangeHandler = mealCountChangeHandler;\n    vm.removePassengerFlightMeal = removePassengerFlightMeal;\n    vm.getSelectedPassengerFlightMeal = getSelectedPassengerFlightMeal;\n    vm.scrollToStart = scrollToStart;\n    vm.scrollToEnd = scrollToEnd;\n    vm.hasAlias = backend.hasAlias;\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\n\n    vm.canScrollRight = true;\n    vm.canScrollLeft = false;\n\n    vm.selectedFlight = 0;\n    vm.selectedPassenger = 0;\n\n    if (backend.getParam('site.externalStorageBaseUrl')) {\n        vm.mealImagesPath = backend.getParam('site.externalStorageBaseUrl') + '/img/content/meal';\n    } else {\n        vm.mealImagesPath = './themes/websky/assets/static/img/content/meal';\n    }\n\n    backend.addOrderInfoListener(function (orderInfo) {\n        vm.orderInfo = orderInfo;\n    }, false, true);\n\n    $scope.$watch('vm.service', function () {\n        updateMealMenu();\n    });\n\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\n\n    if (vm.service.active) {\n        updateMealMenu();\n    }\n\n    function switchService() {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal')) {\n            vm.service.active = !vm.service.active;\n            if (vm.service.active) {\n                selectFirstAvailablePassengerFlight();\n            } else {\n                backend.removeExtraService({\n                    code: 'meal'\n                });\n            }\n        }\n    }\n\n    function resetService() {\n      backend.removeExtraService({\n          code: 'meal'\n      });\n    }\n\n    function selectFlightPassenger(flightNum, passengerNum) {\n        vm.selectedFlight = flightNum;\n        vm.selectedPassenger = passengerNum;\n        updateMealMenu();\n    }\n\n    function selectFirstAvailablePassengerFlight() {\n        vm.selectedFlight = getFirstAvailableFlightNum();\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\n        updateMealMenu();\n    }\n\n    function updateMealMenu() {\n        vm.mealMenu = vm.service.itemsByPassengerSegments[vm.selectedPassenger][vm.selectedFlight];\n        vm.mealMenuSubgroup = false;\n    }\n\n    function mealCountChangeHandler(subgroupNum, mealItem, delta) {\n        if (!vm.locked) {\n            backend.modifyExtraService({\n                code: 'meal',\n                passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\n                segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\n                subgroup: vm.service.subgroups[subgroupNum],\n                amount: (mealItem.alreadySelectedCount || 0) + delta,\n                service_type: mealItem.serviceType,\n                rfisc: mealItem.rfisc\n            });\n        }\n    }\n\n    function removePassengerFlightMeal(passengerNum, flightNum) {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('meal', passengerNum, flightNum)) {\n            backend.removeExtraService({\n                code: 'meal',\n                passenger_id: vm.orderInfo.passengers[passengerNum].id,\n                segment_id: vm.orderInfo.plainFlights[flightNum].id\n            });\n        }\n    }\n\n    function getSelectedPassengerFlightMeal(passengerNum, flightNum) {\n\n        var count = 0,\n            cost = 0,\n            currency;\n\n        if (\n            vm.orderInfo.groupedEditableExtraServices &&\n            vm.orderInfo.groupedEditableExtraServices.meal &&\n            vm.orderInfo.groupedEditableExtraServices.meal[passengerNum] &&\n            vm.orderInfo.groupedEditableExtraServices.meal[passengerNum][flightNum] &&\n            vm.orderInfo.groupedEditableExtraServices.meal[passengerNum][flightNum].length\n        ) {\n            vm.orderInfo.groupedEditableExtraServices.meal[passengerNum][flightNum].forEach(function (item) {\n                if (item.amount) {\n                    count += item.amount;\n                }\n                if (item.totalPrice) {\n                    cost = Big(cost).plus(item.totalPrice).toFixed(2);\n                    currency = item.currency;\n                }\n            });\n        }\n\n        if (count) {\n            return {\n                count: count,\n                cost: cost,\n                currency: currency\n            };\n        } else {\n            return false;\n        }\n\n    }\n\n    function scrollToStart() {\n        passengersTableContainer.scrollTo(0);\n    }\n\n    function scrollToEnd() {\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\n    }\n\n    function mobileTableScrollHandler() {\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\n            scrollWidth = passengersTableContainer[0].scrollWidth,\n            clientWidth = passengersTableContainer[0].clientWidth,\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\n        vm.canScrollRight = (scrollRight !== 0);\n        vm.canScrollLeft = (scrollLeft !== 0);\n        $scope.$apply();\n    }\n\n    function getFirstAvailableFlightNum() {\n        var i;\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n            if (vm.service.availableBySegments[i]) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    function getFirstAvailablePassengerNum(flightNum) {\n        var i;\n        if (vm.service.availableByPassengerSegments) {\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\n                    return i;\n                }\n            }\n        }\n        return -1;\n    }\n\n}\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nangular.module('wes').component('esSeatPegas', {\n    templateUrl: 'components/es-seat-pegas/es-seat-pegas.html',\n    controller: ['$scope', '$element', '$timeout', 'backend', 'utils', SeatControllerPegas],\n    controllerAs: 'vm',\n    bindings: {\n        service: '=service',\n        locked: '=locked'\n    }\n});\n\nfunction SeatControllerPegas($scope, $element, $timeout, backend, utils) {\n\n    var vm = this,\n        passengersTableContainer = $element.find('div.passengersTableContainer'),\n        seatMapContainerTopPosition = '0px';\n\n    vm.switchService = switchService;\n    vm.resetService = resetService;\n\n    vm.selectFlightPassenger = selectFlightPassenger;\n    vm.selectFirstAvailablePassengerFlight = selectFirstAvailablePassengerFlight;\n    vm.setPassengerFlightSeat = setPassengerFlightSeat;\n\n    vm.hasAlias = backend.hasAlias;\n\n    vm.scrollToStart = scrollToStart;\n    vm.scrollToEnd = scrollToEnd;\n\n    vm.getAvailablePassengersCount = utils.getAvailablePassengersCount;\n    vm.getAvailablePassengersCountWrap = getAvailablePassengersCountWrap;\n\n    vm.removePassengerFlightSeat = removePassengerFlightSeat;\n\n    vm.checkServiceRemovalProhibited = backend.checkServiceRemovalProhibited;\n\n    vm.canScrollRight = true;\n    vm.canScrollLeft = false;\n\n    backend.addOrderInfoListener(function (orderInfo) {\n        vm.orderInfo = orderInfo;\n    }, false, true);\n\n    updateSunInfoByFlights();\n\n    passengersTableContainer.on('scroll', mobileTableScrollHandler);\n\n    if (vm.service.active) {\n        selectFirstAvailablePassengerFlight();\n    }\n\n    function switchService() {\n        if (!vm.locked && !backend.checkServiceRemovalProhibited('seat')) {\n            vm.service.active = !vm.service.active;\n            if (vm.service.active) {\n                selectFirstAvailablePassengerFlight();\n            } else {\n                vm.modifyError = false;\n                backend.removeExtraService({\n                    code: 'seat'\n                }).then(clearFlightPassenger, function (resp) {\n                    if (resp.error) {\n                        vm.modifyError = resp.error;\n                    }\n                });\n            }\n        }\n    }\n\n    function resetService() {\n      vm.modifyError = false;\n      backend.removeExtraService({\n          code: 'seat'\n      }).then(clearFlightPassenger, function (resp) {\n          if (resp.error) {\n              vm.modifyError = resp.error;\n          }\n      });\n    }\n\n    function clearFlightPassenger() {\n        vm.seatMap = false;\n        vm.selectedFlight = -1;\n        vm.selectedPassenger = -1;\n    }\n\n    function setSeatMapContainerTopPosition(reset) {\n        if (reset) {\n            seatMapContainerTopPosition = '0px';\n        } else {\n            seatMapContainerTopPosition = jQuery('#seatMapCont .mCSB_container').css('top');\n        }\n    }\n\n    function selectFlightPassenger(flightNum, passengerNum) {\n        // Нужно запомнить положение карты мест для переключения между пассажирами одного сегмента\n        setSeatMapContainerTopPosition(vm.selectedFlight !== flightNum);\n        vm.selectedFlight = flightNum;\n        vm.selectedPassenger = passengerNum;\n        updateSeatMap();\n    }\n\n    function selectFirstAvailablePassengerFlight() {\n        vm.selectedFlight = getFirstAvailableFlightNum();\n        vm.selectedPassenger = getFirstAvailablePassengerNum(vm.selectedFlight);\n        updateSeatMap();\n    }\n\n    function updateSeatMap() {\n\n        if (vm.selectedPassenger !== -1 && vm.selectedFlight !== -1) {\n            vm.loadingSeatMap = true;\n            vm.seatMapError = false;\n            backend.seatMap(\n                vm.orderInfo.passengers[vm.selectedPassenger].id,\n                vm.orderInfo.plainFlights[vm.selectedFlight].id\n            ).then(function (resp) {\n                vm.seatMap = resp;\n                vm.loadingSeatMap = false;\n                $timeout(function () {\n                    jQuery('#seatMapCont .mCSB_container').css('top', seatMapContainerTopPosition);\n                });\n            }, function (resp) {\n                vm.seatMapError = resp.error;\n                vm.loadingSeatMap = false;\n            });\n        }\n\n    }\n\n    function setPassengerFlightSeat(chair, cabinAllowed, rowNumber) {\n        if (!vm.locked) {\n            if (chair.available && cabinAllowed) {\n                setSeatMapContainerTopPosition();\n                vm.modifyError = false;\n                backend.modifyExtraService({\n                    code: 'seat',\n                    passenger_id: vm.orderInfo.passengers[vm.selectedPassenger].id,\n                    segment_id: vm.orderInfo.plainFlights[vm.selectedFlight].id,\n                    value: rowNumber + chair.number,\n                    subgroup: vm.service.commonSubgroup,\n                    rfisc: chair.rfisc || '',\n                    service_type: 'F'\n                }).then(updateSeatMap, function (resp) {\n                    if (resp.error) {\n                        vm.modifyError = resp.error;\n                    }\n                });\n            }\n        }\n    }\n\n    function updateSunInfoByFlights() {\n        vm.sunInfoByFlights = [];\n        vm.orderInfo.plainFlights.forEach(function (flight, flightNum) {\n            backend.sunInfo(\n                flight.origincity,\n                flight.departuredate,\n                flight.departuretime,\n                flight.destinationcity,\n                flight.arrivaldate,\n                flight.arrivaltime\n            ).then(function (resp) {\n                vm.sunInfoByFlights[flightNum] = resp;\n            });\n        });\n    }\n\n    function getFirstAvailableFlightNum() {\n        var i;\n        for (i = 0; i < vm.orderInfo.plainFlights.length; i++) {\n            if (vm.service.availableBySegments[i]) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    function getFirstAvailablePassengerNum(flightNum) {\n        var i;\n        if (vm.service.availableByPassengerSegments) {\n            for (i = 0; i < vm.orderInfo.passengers.length; i++) {\n                if (vm.service.availableByPassengerSegments[i][flightNum]) {\n                    return i;\n                }\n            }\n        }\n        return -1;\n    }\n\n    function scrollToStart() {\n        passengersTableContainer.scrollTo(0);\n    }\n\n    function scrollToEnd() {\n        passengersTableContainer.scrollTo(passengersTableContainer[0].scrollWidth);\n    }\n\n    function mobileTableScrollHandler() {\n        var scrollLeft = passengersTableContainer[0].scrollLeft,\n            scrollWidth = passengersTableContainer[0].scrollWidth,\n            clientWidth = passengersTableContainer[0].clientWidth,\n            scrollRight = scrollWidth - clientWidth - scrollLeft;\n        vm.canScrollRight = (scrollRight !== 0);\n        vm.canScrollLeft = (scrollLeft !== 0);\n        $scope.$apply();\n    }\n\n    function getAvailablePassengersCountWrap(availableByPassengerSegments) {\n        var count = utils.getAvailablePassengersCount(availableByPassengerSegments);\n        return count + vm.orderInfo.passengers.filter(function (pax) {\n            return !pax.hasSeats;\n        }).length;\n    }\n\n    function removePassengerFlightSeat(passengerNum, flightNum) {\n        if (\n            !vm.locked && !backend.checkServiceRemovalProhibited('seat', passengerNum, flightNum)\n        ) {\n            vm.modifyError = false;\n            backend.removeExtraService({\n                code: 'seat',\n                passenger_id: vm.orderInfo.passengers[passengerNum].id,\n                segment_id: vm.orderInfo.plainFlights[flightNum].id\n            }).then(function () {\n                if (vm.selectedFlight === flightNum) {\n                    updateSeatMap();\n                }\n            }, function (resp) {\n                if (resp.error) {\n                    vm.modifyError = resp.error;\n                }\n            });\n        }\n    }\n\n}\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\nrequire('./components/es-meal-pegas/es-meal-pegas');\r\nrequire('./components/es-seat-pegas/es-seat-pegas');\r\n\n},{\"./components/es-meal-pegas/es-meal-pegas\":1,\"./components/es-seat-pegas/es-seat-pegas\":2}]},{},[3]);\n"]}
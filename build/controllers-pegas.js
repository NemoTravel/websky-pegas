!function(){function e(r,t,s){function n(o,i){if(!t[o]){if(!r[o]){var c="function"==typeof require&&require;if(!i&&c)return c(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var g=t[o]={exports:{}};r[o][0].call(g.exports,function(e){var t=r[o][1][e];return n(t||e)},g,g.exports,e,r,t,s)}return t[o].exports}for(var a="function"==typeof require&&require,o=0;o<s.length;o++)n(s[o]);return n}return e}()({1:[function(e,r,t){"use strict";function s(e,r,t,s){function n(){p.locked||t.checkServiceRemovalProhibited("baggage")||(p.service.active=!p.service.active,p.service.active||t.removeExtraService({code:"baggage"}))}function a(){t.removeExtraService({code:"baggage"})}function o(e){p.locked||t.removeExtraService({code:"baggage",passenger_id:p.orderInfo.passengers[e].id})}function i(e,r,s,n,a){p.locked||t.modifyExtraService({code:p.service.code,passenger_id:p.orderInfo.passengers[n].id,segment_id:p.orderInfo.plainFlights[p.service.routeParts[a].mainFlightNum].id,subgroup:p.service.subgroups[e].code,amount:(r.alreadySelectedCount||0)+s,service_type:r.serviceType,rfisc:r.rfisc})}function c(e){return e.map(function(e){return e.availableExtraServicesByPassengersAndSubgroups.map(function(e){return e.map(function(e){var r;return e.forEach(function(e,t){e.amount&&(r=t)}),r})})})}function l(e,r){p.selectedRoutePartNum=e,p.selectedPassenger=r}function g(e,r,s){var n=p.selectedBaggageByRoutePartsAndPassengers[r][e][s],a=p.service.routeParts[r].availableExtraServicesByPassengersAndSubgroups[e][s][n],o=p.selectedBaggageByRoutePartsAndPassengersView[r][e][s],i=p.service.routeParts[r].availableExtraServicesByPassengersAndSubgroups[e][s][o],c=!1;p.locked||(i&&(c={code:"baggage",passenger_id:i.passengerId,segment_id:i.mainSegmentId,subgroup:i.subgroupCode,amount:1,service_type:i.serviceType,rfisc:i.rfisc}),c?t.modifyExtraService(c):a&&t.removeExtraService({code:"baggage",passenger_id:a.passengerId,segment_id:a.mainSegmentId,subgroup:a.subgroupCode,service_type:a.serviceType,rfisc:a.rfisc}))}function d(e,r){var t,s=0,n=0,a=p.service.routeParts[r],o=a.availableExtraServicesByPassengersAndSubgroups[e];return o&&o.length&&o.forEach(function(e){e.forEach(function(e){e.amount&&(s+=e.amount),e.totalPrice&&(n=Big(n).plus(e.totalPrice).toFixed(2),t=e.currency)})}),s?{count:s,cost:n,currency:t}:!1}function u(){h.scrollTo(0)}function v(){h.scrollTo(h[0].scrollWidth)}function f(){var e=h[0].scrollLeft,t=h[0].scrollWidth,s=h[0].clientWidth,n=t-s-e;p.canScrollRight=0!==n,p.canScrollLeft=0!==e,r.$apply()}function m(e,r){p.locked||t.checkServiceRemovalProhibited("baggage",e,r)||t.removeExtraService({code:"baggage",passenger_id:p.orderInfo.passengers[e].id,segment_id:p.orderInfo.plainFlights[r].id})}var p=this,h=e.find("div.passengersTableContainer");p.switchService=n,p.resetService=a,p.baggageCountChangeHandler=i,p.selectRoutePartPassenger=l,p.changeBaggageBySelect=g,p.removeByPassenger=o,p.getSelectedPassengerRoutePartBaggage=d,p.scrollToStart=u,p.scrollToEnd=v,p.removePassengerFlightBaggage=m,p.checkServiceRemovalProhibited=t.checkServiceRemovalProhibited,p.canScrollRight=!0,p.canScrollLeft=!1,p.selectedRoutePartNum=0,p.selectedPassenger=0,p.optionsByRoutePartsAndPassengers=p.service.routeParts.map(function(e){return e.availableExtraServicesByPassengersAndSubgroups.map(function(e){return e.map(function(e){return s.createOptionsForUiSelect(e,{title:t.getAlias("web.extraServices.baggage.noneSelected")})})})}),r.$watch("vm.service.routeParts",function(){p.selectedBaggageByRoutePartsAndPassengers=c(p.service.routeParts),p.selectedBaggageByRoutePartsAndPassengersView=angular.copy(p.selectedBaggageByRoutePartsAndPassengers)}),t.addOrderInfoListener(function(e){p.orderInfo=e},!1,!0),h.on("scroll",f)}angular.module("wes").component("esBaggagePegas",{templateUrl:"components/es-baggage-pegas/es-baggage-pegas.html",controller:["$element","$scope","backend","utils",s],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],2:[function(e,r,t){"use strict";function s(e,r,t,s){function n(){h.locked||t.checkServiceRemovalProhibited("meal")||(h.service.active=!h.service.active,h.service.active?i():t.removeExtraService({code:"meal"}))}function a(){t.removeExtraService({code:"meal"})}function o(e,r){h.selectedFlight=e,h.selectedPassenger=r,c()}function i(){h.selectedFlight=m(),h.selectedPassenger=p(h.selectedFlight),c()}function c(){h.mealMenu=h.service.itemsByPassengerSegments[h.selectedPassenger][h.selectedFlight],h.mealMenuSubgroup=!1}function l(e,r,s){h.locked||t.modifyExtraService({code:"meal",passenger_id:h.orderInfo.passengers[h.selectedPassenger].id,segment_id:h.orderInfo.plainFlights[h.selectedFlight].id,subgroup:h.service.subgroups[e],amount:(r.alreadySelectedCount||0)+s,service_type:r.serviceType,rfisc:r.rfisc})}function g(e,r){h.locked||t.checkServiceRemovalProhibited("meal",e,r)||t.removeExtraService({code:"meal",passenger_id:h.orderInfo.passengers[e].id,segment_id:h.orderInfo.plainFlights[r].id})}function d(e,r){var t,s=0,n=0;return h.orderInfo.groupedEditableExtraServices&&h.orderInfo.groupedEditableExtraServices.meal&&h.orderInfo.groupedEditableExtraServices.meal[e]&&h.orderInfo.groupedEditableExtraServices.meal[e][r]&&h.orderInfo.groupedEditableExtraServices.meal[e][r].length&&h.orderInfo.groupedEditableExtraServices.meal[e][r].forEach(function(e){e.amount&&(s+=e.amount),e.totalPrice&&(n=Big(n).plus(e.totalPrice).toFixed(2),t=e.currency)}),s?{count:s,cost:n,currency:t}:!1}function u(){S.scrollTo(0)}function v(){S.scrollTo(S[0].scrollWidth)}function f(){var r=S[0].scrollLeft,t=S[0].scrollWidth,s=S[0].clientWidth,n=t-s-r;h.canScrollRight=0!==n,h.canScrollLeft=0!==r,e.$apply()}function m(){var e;for(e=0;e<h.orderInfo.plainFlights.length;e++)if(h.service.availableBySegments[e])return e;return-1}function p(e){var r;if(h.service.availableByPassengerSegments)for(r=0;r<h.orderInfo.passengers.length;r++)if(h.service.availableByPassengerSegments[r][e])return r;return-1}var h=this,S=r.find("div.passengersTableContainer");h.switchService=n,h.resetService=a,h.selectFlightPassenger=o,h.selectFirstAvailablePassengerFlight=i,h.mealCountChangeHandler=l,h.removePassengerFlightMeal=g,h.getSelectedPassengerFlightMeal=d,h.scrollToStart=u,h.scrollToEnd=v,h.hasAlias=t.hasAlias,h.getAvailablePassengersCount=s.getAvailablePassengersCount,h.checkServiceRemovalProhibited=t.checkServiceRemovalProhibited,h.canScrollRight=!0,h.canScrollLeft=!1,h.selectedFlight=0,h.selectedPassenger=0,t.getParam("site.externalStorageBaseUrl")?h.mealImagesPath=t.getParam("site.externalStorageBaseUrl")+"/img/content/meal":h.mealImagesPath="./themes/websky/assets/static/img/content/meal",t.addOrderInfoListener(function(e){h.orderInfo=e},!1,!0),e.$watch("vm.service",function(){c()}),S.on("scroll",f),h.service.active&&c()}angular.module("app").component("esMealPegas",{templateUrl:"components/es-meal-pegas/es-meal-pegas.html",controller:["$scope","$element","backend","utils",s],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],3:[function(e,r,t){"use strict";function s(e,r,t,s,n){function a(){y.locked||s.checkServiceRemovalProhibited("seat")||(y.service.active=!y.service.active,y.service.active?g():(y.modifyError=!1,s.removeExtraService({code:"seat"}).then(i,function(e){e.error&&(y.modifyError=e.error)})))}function o(){y.modifyError=!1,s.removeExtraService({code:"seat"}).then(i,function(e){e.error&&(y.modifyError=e.error)})}function i(){y.seatMap=!1,y.selectedFlight=-1,y.selectedPassenger=-1}function c(e){F=e?"0px":jQuery("#seatMapCont .mCSB_container").css("top")}function l(e,r){c(y.selectedFlight!==e),y.selectedFlight=e,y.selectedPassenger=r,d()}function g(){y.selectedFlight=f(),y.selectedPassenger=m(y.selectedFlight),d()}function d(){-1!==y.selectedPassenger&&-1!==y.selectedFlight&&(y.loadingSeatMap=!0,y.seatMapError=!1,s.seatMap(y.orderInfo.passengers[y.selectedPassenger].id,y.orderInfo.plainFlights[y.selectedFlight].id).then(function(e){y.seatMap=e,y.loadingSeatMap=!1,t(function(){jQuery("#seatMapCont .mCSB_container").css("top",F)})},function(e){y.seatMapError=e.error,y.loadingSeatMap=!1}))}function u(e,r,t){y.locked||e.available&&r&&(c(),y.modifyError=!1,s.modifyExtraService({code:"seat",passenger_id:y.orderInfo.passengers[y.selectedPassenger].id,segment_id:y.orderInfo.plainFlights[y.selectedFlight].id,value:t+e.number,subgroup:y.service.commonSubgroup,rfisc:e.rfisc||"",service_type:"F"}).then(d,function(e){e.error&&(y.modifyError=e.error)}))}function v(){y.sunInfoByFlights=[],y.orderInfo.plainFlights.forEach(function(e,r){s.sunInfo(e.origincity,e.departuredate,e.departuretime,e.destinationcity,e.arrivaldate,e.arrivaltime).then(function(e){y.sunInfoByFlights[r]=e})})}function f(){var e;for(e=0;e<y.orderInfo.plainFlights.length;e++)if(y.service.availableBySegments[e])return e;return-1}function m(e){var r;if(y.service.availableByPassengerSegments)for(r=0;r<y.orderInfo.passengers.length;r++)if(y.service.availableByPassengerSegments[r][e])return r;return-1}function p(){E.scrollTo(0)}function h(){E.scrollTo(E[0].scrollWidth)}function S(){var r=E[0].scrollLeft,t=E[0].scrollWidth,s=E[0].clientWidth,n=t-s-r;y.canScrollRight=0!==n,y.canScrollLeft=0!==r,e.$apply()}function P(e){var r=n.getAvailablePassengersCount(e);return r+y.orderInfo.passengers.filter(function(e){return!e.hasSeats}).length}function b(e,r){y.locked||s.checkServiceRemovalProhibited("seat",e,r)||(y.modifyError=!1,s.removeExtraService({code:"seat",passenger_id:y.orderInfo.passengers[e].id,segment_id:y.orderInfo.plainFlights[r].id}).then(function(){y.selectedFlight===r&&d()},function(e){e.error&&(y.modifyError=e.error)}))}var y=this,E=r.find("div.passengersTableContainer"),F="0px";y.switchService=a,y.resetService=o,y.selectFlightPassenger=l,y.selectFirstAvailablePassengerFlight=g,y.setPassengerFlightSeat=u,y.hasAlias=s.hasAlias,y.scrollToStart=p,y.scrollToEnd=h,y.getAvailablePassengersCount=n.getAvailablePassengersCount,y.getAvailablePassengersCountWrap=P,y.removePassengerFlightSeat=b,y.checkServiceRemovalProhibited=s.checkServiceRemovalProhibited,y.canScrollRight=!0,y.canScrollLeft=!1,s.addOrderInfoListener(function(e){y.orderInfo=e},!1,!0),v(),E.on("scroll",S),y.service.active&&g()}angular.module("wes").component("esSeatPegas",{templateUrl:"components/es-seat-pegas/es-seat-pegas.html",controller:["$scope","$element","$timeout","backend","utils",s],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],4:[function(e,r,t){"use strict";e("./components/es-meal-pegas/es-meal-pegas"),e("./components/es-seat-pegas/es-seat-pegas"),e("./components/es-baggage-pegas/es-baggage-pegas")},{"./components/es-baggage-pegas/es-baggage-pegas":1,"./components/es-meal-pegas/es-meal-pegas":2,"./components/es-seat-pegas/es-seat-pegas":3}]},{},[4]);
//# sourceMappingURL=controllers-pegas.js.map

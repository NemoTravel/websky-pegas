!function(){function e(r,t,n){function s(i,a){if(!t[i]){if(!r[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(o)return o(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var d=t[i]={exports:{}};r[i][0].call(d.exports,function(e){var t=r[i][1][e];return s(t||e)},d,d.exports,e,r,t,n)}return t[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)s(n[i]);return s}return e}()({1:[function(e,r,t){"use strict";function n(e,r,t,n){function s(){p.locked||t.checkServiceRemovalProhibited("meal")||(p.service.active=!p.service.active,p.service.active?a():t.removeExtraService({code:"meal"}))}function o(){t.removeExtraService({code:"meal"})}function i(e,r){p.selectedFlight=e,p.selectedPassenger=r,c()}function a(){p.selectedFlight=m(),p.selectedPassenger=h(p.selectedFlight),c()}function c(){p.mealMenu=p.service.itemsByPassengerSegments[p.selectedPassenger][p.selectedFlight],p.mealMenuSubgroup=!1}function l(e,r,n){p.locked||t.modifyExtraService({code:"meal",passenger_id:p.orderInfo.passengers[p.selectedPassenger].id,segment_id:p.orderInfo.plainFlights[p.selectedFlight].id,subgroup:p.service.subgroups[e],amount:(r.alreadySelectedCount||0)+n,service_type:r.serviceType,rfisc:r.rfisc})}function d(e,r){p.locked||t.checkServiceRemovalProhibited("meal",e,r)||t.removeExtraService({code:"meal",passenger_id:p.orderInfo.passengers[e].id,segment_id:p.orderInfo.plainFlights[r].id})}function g(e,r){var t,n=0,s=0;return p.orderInfo.groupedEditableExtraServices&&p.orderInfo.groupedEditableExtraServices.meal&&p.orderInfo.groupedEditableExtraServices.meal[e]&&p.orderInfo.groupedEditableExtraServices.meal[e][r]&&p.orderInfo.groupedEditableExtraServices.meal[e][r].length&&p.orderInfo.groupedEditableExtraServices.meal[e][r].forEach(function(e){e.amount&&(n+=e.amount),e.totalPrice&&(s=Big(s).plus(e.totalPrice).toFixed(2),t=e.currency)}),n?{count:n,cost:s,currency:t}:!1}function u(){S.scrollTo(0)}function f(){S.scrollTo(S[0].scrollWidth)}function v(){var r=S[0].scrollLeft,t=S[0].scrollWidth,n=S[0].clientWidth,s=t-n-r;p.canScrollRight=0!==s,p.canScrollLeft=0!==r,e.$apply()}function m(){var e;for(e=0;e<p.orderInfo.plainFlights.length;e++)if(p.service.availableBySegments[e])return e;return-1}function h(e){var r;if(p.service.availableByPassengerSegments)for(r=0;r<p.orderInfo.passengers.length;r++)if(p.service.availableByPassengerSegments[r][e])return r;return-1}var p=this,S=r.find("div.passengersTableContainer");p.switchService=s,p.resetService=o,p.selectFlightPassenger=i,p.selectFirstAvailablePassengerFlight=a,p.mealCountChangeHandler=l,p.removePassengerFlightMeal=d,p.getSelectedPassengerFlightMeal=g,p.scrollToStart=u,p.scrollToEnd=f,p.hasAlias=t.hasAlias,p.getAvailablePassengersCount=n.getAvailablePassengersCount,p.checkServiceRemovalProhibited=t.checkServiceRemovalProhibited,p.canScrollRight=!0,p.canScrollLeft=!1,p.selectedFlight=0,p.selectedPassenger=0,t.getParam("site.externalStorageBaseUrl")?p.mealImagesPath=t.getParam("site.externalStorageBaseUrl")+"/img/content/meal":p.mealImagesPath="./themes/websky/assets/static/img/content/meal",t.addOrderInfoListener(function(e){p.orderInfo=e},!1,!0),e.$watch("vm.service",function(){c()}),S.on("scroll",v),p.service.active&&c()}angular.module("app").component("esMealPegas",{templateUrl:"components/es-meal-pegas/es-meal-pegas.html",controller:["$scope","$element","backend","utils",n],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],2:[function(e,r,t){"use strict";function n(e,r,t,n,s){function o(){F.locked||n.checkServiceRemovalProhibited("seat")||(F.service.active=!F.service.active,F.service.active?d():(F.modifyError=!1,n.removeExtraService({code:"seat"}).then(a,function(e){e.error&&(F.modifyError=e.error)})))}function i(){F.modifyError=!1,n.removeExtraService({code:"seat"}).then(a,function(e){e.error&&(F.modifyError=e.error)})}function a(){F.seatMap=!1,F.selectedFlight=-1,F.selectedPassenger=-1}function c(e){y=e?"0px":jQuery("#seatMapCont .mCSB_container").css("top")}function l(e,r){c(F.selectedFlight!==e),F.selectedFlight=e,F.selectedPassenger=r,g()}function d(){F.selectedFlight=v(),F.selectedPassenger=m(F.selectedFlight),g()}function g(){-1!==F.selectedPassenger&&-1!==F.selectedFlight&&(F.loadingSeatMap=!0,F.seatMapError=!1,n.seatMap(F.orderInfo.passengers[F.selectedPassenger].id,F.orderInfo.plainFlights[F.selectedFlight].id).then(function(e){F.seatMap=e,F.loadingSeatMap=!1,t(function(){jQuery("#seatMapCont .mCSB_container").css("top",y)})},function(e){F.seatMapError=e.error,F.loadingSeatMap=!1}))}function u(e,r,t){F.locked||e.available&&r&&(c(),F.modifyError=!1,n.modifyExtraService({code:"seat",passenger_id:F.orderInfo.passengers[F.selectedPassenger].id,segment_id:F.orderInfo.plainFlights[F.selectedFlight].id,value:t+e.number,subgroup:F.service.commonSubgroup,rfisc:e.rfisc||"",service_type:"F"}).then(g,function(e){e.error&&(F.modifyError=e.error)}))}function f(){F.sunInfoByFlights=[],F.orderInfo.plainFlights.forEach(function(e,r){n.sunInfo(e.origincity,e.departuredate,e.departuretime,e.destinationcity,e.arrivaldate,e.arrivaltime).then(function(e){F.sunInfoByFlights[r]=e})})}function v(){var e;for(e=0;e<F.orderInfo.plainFlights.length;e++)if(F.service.availableBySegments[e])return e;return-1}function m(e){var r;if(F.service.availableByPassengerSegments)for(r=0;r<F.orderInfo.passengers.length;r++)if(F.service.availableByPassengerSegments[r][e])return r;return-1}function h(){E.scrollTo(0)}function p(){E.scrollTo(E[0].scrollWidth)}function S(){var r=E[0].scrollLeft,t=E[0].scrollWidth,n=E[0].clientWidth,s=t-n-r;F.canScrollRight=0!==s,F.canScrollLeft=0!==r,e.$apply()}function P(e){var r=s.getAvailablePassengersCount(e);return r+F.orderInfo.passengers.filter(function(e){return!e.hasSeats}).length}function b(e,r){F.locked||n.checkServiceRemovalProhibited("seat",e,r)||(F.modifyError=!1,n.removeExtraService({code:"seat",passenger_id:F.orderInfo.passengers[e].id,segment_id:F.orderInfo.plainFlights[r].id}).then(function(){F.selectedFlight===r&&g()},function(e){e.error&&(F.modifyError=e.error)}))}var F=this,E=r.find("div.passengersTableContainer"),y="0px";F.switchService=o,F.resetService=i,F.selectFlightPassenger=l,F.selectFirstAvailablePassengerFlight=d,F.setPassengerFlightSeat=u,F.hasAlias=n.hasAlias,F.scrollToStart=h,F.scrollToEnd=p,F.getAvailablePassengersCount=s.getAvailablePassengersCount,F.getAvailablePassengersCountWrap=P,F.removePassengerFlightSeat=b,F.checkServiceRemovalProhibited=n.checkServiceRemovalProhibited,F.canScrollRight=!0,F.canScrollLeft=!1,n.addOrderInfoListener(function(e){F.orderInfo=e},!1,!0),f(),E.on("scroll",S),F.service.active&&d()}angular.module("wes").component("esSeatPegas",{templateUrl:"components/es-seat-pegas/es-seat-pegas.html",controller:["$scope","$element","$timeout","backend","utils",n],controllerAs:"vm",bindings:{service:"=service",locked:"=locked"}})},{}],3:[function(e,r,t){"use strict";e("./components/es-meal-pegas/es-meal-pegas"),e("./components/es-seat-pegas/es-seat-pegas")},{"./components/es-meal-pegas/es-meal-pegas":1,"./components/es-seat-pegas/es-seat-pegas":2}]},{},[3]);
//# sourceMappingURL=controllers-pegas.js.map
